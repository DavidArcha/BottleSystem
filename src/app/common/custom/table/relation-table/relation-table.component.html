<div class="selected-fields-table" *ngIf="selectedFields.length > 0">
    <!-- Error message display -->
    <div class="error-message" *ngIf="error">
        {{ error }}
    </div>

    <table>
        <thead>
            <tr>
                <th>Parent</th>
                <th>Field</th>
                <th>Operator</th>
                <th>Value</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let field of selectedFields; let i = index">
                <td class="parent">
                    <!-- Loading indicator -->
                    <div *ngIf="isLoading" class="loading-indicator">
                        <span>Loading...</span>
                    </div>
                    <!-- Parent dropdown -->
                    <ng-container *ngIf="shouldShowParentDropdown(field) && !isLoading">
                        <app-table-dropdown [data]="systemTypeData" [isTableView]="false" [multiSelect]="true"
                            [selectedValues]="getParentSelectedIds(field)" [selectedLanguage]="selectedLanguage"
                            (selectedValuesChange)="onParentValueChange($event, i)">
                        </app-table-dropdown>

                        <!-- Validation error -->
                        <div class="validation-error" *ngIf="field.parentTouched && !isParentValid(field)">
                            Please select a parent.
                        </div>
                    </ng-container>

                    <!-- Display parent label when dropdown shouldn't be shown -->
                    <ng-container *ngIf="!shouldShowParentDropdown(field) && !isLoading">
                        {{ (field.parent && field.parent.label) || '' }}
                    </ng-container>
                </td>

                <!-- Placeholder for other columns -->
                <td class="field">{{ getFieldLabel(field) }}</td>
                <td class="operator">
                    <ng-container *ngIf="!isLoading">
                        <app-table-dropdown [data]="getOperatorDataForField(field, i)" [isTableView]="false"
                            [multiSelect]="false" [selectedValues]="getOperatorSelectedIds(field)"
                            [selectedLanguage]="selectedLanguage"
                            (selectedValuesChange)="onOperatorValueChange($event, i)">
                        </app-table-dropdown>

                        <!-- Validation error for operator -->
                        <div class="validation-error" *ngIf="field.operatorTouched && !isOperatorValid(field)">
                            Please select an operator.
                        </div>
                    </ng-container>
                </td>
                <td class="value" *ngIf="getValueControl(field).show && isOperatorValid(field)">{{ field.value }}</td>
                <td *ngIf="(!getValueControl(field).show || !isOperatorValid(field)) && shouldShowValueColumn()">
                <td>

                </td>
            </tr>
        </tbody>
    </table>
</div>

<!-- No data message -->
<div class="no-data-message" *ngIf="selectedFields.length === 0">
    No fields selected.
</div>